---
title: 容器镜像系列教程:(一)初识Docker
date: 2025-03-02 11:58:50
tags:
  - 容器
  - Docker
  - 镜像
categories:
  - [系列教程,容器镜像系列教程]
---

## Docker技术简介

Docker，目前非常热门的一项技术，只要你从事软件开发，就一定听说过这项技术。那，Docker究竟是什么？让我们来看下维基百科对它下的定义：**Docker 是一种工具，用于在轻量级容器中自动部署应用程序，以便应用程序可以在不同的环境中隔离高效工作**。Docker容器技术在云计算时代是非常重要的技术底座，极大地提升了程序的部署和分发效率。

## 为什么要使用Docker

为什么要使用Docker？在回答这个问题之前，我们需要先看一下在容器技术出现之前，大家是使用什么环境去部署应用程序的。

在Docker技术之前，大家基本上是使用虚拟机来进行应用部署的。比方说，我开发了一个qq这样的应用程序，我需要部署它的服务端，我需要将qq的软件包上传到虚拟机上，再对虚拟机上的环境变量或者配置文件进行编辑，最终，再使用启动脚本运行该程序，这就是一个常见的部署场景，但是，这中间有两个问题，第一个问题是**多实例的扩容非常麻烦**，假设需要在另一台服务器上再部署该程序，需要将虚拟机上的应用程序打包，同时还要在另一台服务器上安装各种各样的依赖，如果已经做成标准化的脚本还好，要是没有，那得麻烦死；第二个问题是**虚拟机本身是重载的，消耗资源**，运行虚拟机本身就是很耗费资源的一件事，同时，如果在一个虚拟机上跑多个应用程序，程序之间可能会存在互相影响，导致多个应用程序运行异常。

为了解决上面提到的两个问题，Docker技术应运而生，同时兼顾了轻量化、隔离性好和容易迁移的特性。

应用在容器中运行，容器运行在宿主机上，每个容器是单独的、互相隔离的环境。容器的应用部署架构图和虚拟机的应用架构部署图如下，区别在于虚拟机部署需要一套重载的OS系统，这消耗了大量不必要的资源。

![img](/img/容器镜像系列教程/容器VS虚拟机.png)



## Docker技术原理

### 核心概念

在Docker技术中，有以下三种核心概念：

* 镜像（Image)：

  镜像是容器的静态模板，包含运行应用程序所需的所有文件和配置。镜像由多层只读文件系统组成，每一层代表一个构建步骤（如安装软件、添加文件）。镜像通过`Dockerfile`定义，使用`docker build`命令构建。

* 容器（Container)：

  容器是Docker的核心运行单元，是一个轻量级、独立、可执行的软件包，包含应用程序及其所有依赖项（如库、环境变量、配置文件）。容器基于镜像创建，运行在隔离的用户空间中，与宿主机共享操作系统内核，但拥有独立的文件系统、网络和进程空间。

* 仓库（Registry）：

  仓库是用于存储和分发镜像的集中化平台，分为公共仓库（如Docker Hub）和私有仓库（如自建Harbor）。镜像通过`docker push`上传到仓库，通过`docker pull`下载。

三者之间的关系可以用下图表示：

![img](/img/容器镜像系列教程/docker操作流程图.png)

### 底层技术原理

相信听到docker的神奇效果，你也会想知道到底docker是如何实现这样神奇的功效的，下面来介绍一下Docker容器化技术所使用到的两大核心底层技术：命名空间（Namespace）和控制组（CGroup）。

------

#### 1. **命名空间（Namespace）**

命名空间是Linux内核提供的一种隔离机制，用于将系统资源（如进程、网络、文件系统等）划分为独立的虚拟空间，使得每个命名空间中的资源对其他命名空间不可见。容器通过命名空间实现资源隔离，确保每个容器拥有独立的运行环境。

**主要命名空间类型**：

- **PID Namespace**：隔离进程ID，容器内的进程从PID 1开始，与宿主机进程隔离。
- **Mount Namespace**：隔离文件系统挂载点，容器拥有独立的文件系统视图。
- **Network Namespace**：隔离网络接口、IP地址、路由表等，容器拥有独立的网络栈。
- **UTS Namespace**：隔离主机名和域名，容器可以拥有独立的主机名。
- **IPC Namespace**：隔离进程间通信（如消息队列、共享内存）。
- **User Namespace**：隔离用户和用户组ID，容器内的root用户不等于宿主机的root用户。

**作用**：

- 提供资源隔离，确保容器之间互不干扰。
- 增强安全性，限制容器对宿主机和其他容器的影响。

------

#### 2. **控制组（CGroup）**

控制组是Linux内核提供的一种资源管理机制，用于限制、记录和隔离进程组的资源使用（如CPU、内存、磁盘I/O等）。容器通过CGroup实现资源限制和优先级控制，确保容器不会过度占用宿主机资源。

**主要功能**：

- 资源限制：限制容器使用的CPU、内存、磁盘I/O等资源。
- 优先级控制：为容器分配资源使用优先级。
- 资源统计：记录容器的资源使用情况，便于监控和优化。
- **进程控制**：冻结、恢复或终止容器内的进程。

**作用**：

- 防止单个容器耗尽宿主机资源，影响其他容器或系统稳定性。
- 提供细粒度的资源管理，优化资源利用率。

------

####  **命名空间与CGroup的关系**

- **命名空间**：负责资源隔离，确保容器拥有独立的运行环境。
- **CGroup**：负责资源限制，确保容器不会过度占用资源。
  两者结合，共同实现容器的轻量级虚拟化和资源管理。



## Docker实用工具和生态

1. **开发与部署工具**  
   - **Docker Compose**：多容器编排的YAML定义（`docker-compose.yml`）。
   - **Docker Swarm**：原生集群管理（与Kubernetes的定位差异）。
   - **Kubernetes集成**：Docker作为容器运行时（CRI规范）。

2. **镜像与安全工具**  
   - **Docker Slim**：镜像瘦身优化。
   - **Trivy/Clair**：镜像漏洞扫描。
   - **Docker Bench for Security**：安全基线检查。

3. **监控与可视化**  
   - **cAdvisor**：容器资源监控。
   - **Portainer**：图形化管理界面。

4. **CI/CD场景实践**  
   - **GitLab CI与Docker**：自动化构建与测试。
   - **Jenkins Pipeline**：容器化构建环境配置。

---

### **结语**
在当前的云计算领域，K8S已经成为编排部署的事实标准，而K8S正是使用容器化技术作为根基，随着越来越多的人使用容器化技术，容器化将继续为人们带来高效便捷的部署能力，并发展出新的功能特性，反过来推动云原生发展壮大。本文碍于篇幅，只对核心概念和原理等做了简要概述，该系列文章后续将更侧重于实际的使用，我们下一篇文章再见！

---

### **参考资料**

[Docker: Accelerated Container Application Development](https://www.docker.com/)

[Docker容器技术介绍（内含详细教程） - 知乎](https://zhuanlan.zhihu.com/p/126687430)

[Docker (software) - Wikipedia](https://en.wikipedia.org/wiki/Docker_(software))